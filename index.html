<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Yes I need Root</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Yes I need Root">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Yes I need Root">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yes I need Root">
  
    <link rel="alternate" href="/atom.xml" title="Yes I need Root" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Yes I need Root</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-dietpi镜像有时无法使用pishrink脚本缩小的原因" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/17/dietpi镜像有时无法使用pishrink脚本缩小的原因/" class="article-date">
  <time datetime="2019-10-17T14:04:08.000Z" itemprop="datePublished">2019-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/17/dietpi镜像有时无法使用pishrink脚本缩小的原因/">dietpi镜像有时无法使用pishrink脚本缩小的原因</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>记录以备查</p>
<p>一般使用Win32DiskImager在windows系统上备份树莓派的镜像，这种方式备份出来的镜像为sd卡容量的大小，若在16g卡上安装了一个4g不到的系统，备份出来不仅占空间，刷入时也更花时间，最尴尬的是都是16g的卡也有可能出现略微的容量差异，导致容量小一点的就没法刷入。</p>
<p>在看<a href="https://blog.csdn.net/lb1885727/article/details/77574502" target="_blank" rel="noopener">Raspberrypi 3 系统备份还原， 基于最小系统镜像实现</a>一文时，注意到以下这句话，才意识到dietpi镜像使用pishrink脚本缩小报ERROR: Image already shrunk to smallest size的原因。<br><img src="/img/2019/boot_and_root.png" alt></p>
<p>经搜索，发现dietpi系统应该是只在第一次启动时会扩展分区，这被写成一个service而不是像raspberry系统中可以在raspi-config命令后找到，推测运行一次就被mask（注销unit）了。而在工作过程中，16g的卡，我可能用pishrink脚本将初始的dietpi镜像缩小成了4g的dietpi-shrink.img，再把dietpi-shrink.img写入到新的sd后，扩展分区的服务（dietpi-fs_partition_resize.service）并不会运行了，所以/root分区的大小可能就只有3.7g，若再把这个新sd卡上的镜像备份出来（16g），那就无法使用pishrink缩小了。</p>
<p><a href="https://github.com/MichaIng/DietPi/issues/1821" target="_blank" rel="noopener">DietPi-Drive_Manager | Expand file system button, in case of changed storage</a><br>以上链接给出了解决方法，不需要手动扩展，毕竟方便，只需把扩展分区服务unmask。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl unmask dietpi-fs_partition_resize.service</span><br><span class="line">systemctl enable dietpi-fs_partition_resize.service</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>重启后备份这个新sd卡上的镜像出来，就又可以使用pishrink缩小了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/17/dietpi镜像有时无法使用pishrink脚本缩小的原因/" data-id="ck1us3rgj0004tc0ox0uzy1k1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dietpi/">dietpi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pishrink/">pishrink</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树莓派/">树莓派</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-node-red代码版本控制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/22/node-red代码版本控制/" class="article-date">
  <time datetime="2019-08-22T14:04:23.000Z" itemprop="datePublished">2019-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/22/node-red代码版本控制/">node-red代码版本控制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>记录以备查</p>
<p>之前对于node-red代码的备份都是复制~/.node-red/flows_xxx.json文件并保存n个版本，很烦，即使使用Beyond Compare这种对比软件去对比未美化格式的json文件查看更改内容也是一团糟，搜索时发现可以通过更改~/.node-red/settings.js中的设置使flows_xxx.json文件保存时就美化格式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo nano ~/.node-red/settings.js</span><br><span class="line"># ctrl+w 搜索 flowFilePretty 找到该行并取消注释</span><br></pre></td></tr></table></figure></p>
<p>复制文件并不是一个好的版本控制解决方案，发现官方在0.18版本开始就有projects一说并支持版本控制，只是在设置里默认不开启。详见<a href="https://nodered.org/docs/user-guide/projects/" target="_blank" rel="noopener">projects</a></p>
<ol>
<li>开启projects支持</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo nano ~/.node-red/settings.js</span><br><span class="line"># 找到projects: &#123;enabled: false&#125; 改为 enabled: true</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>重启node-red</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -ll ~/.node-red/</span><br><span class="line"># 会发现多了projects/目录</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>重新访问node-red网页服务地址如127.0.0.1:1880<br>根据提示创建或者克隆项目</p>
</li>
<li><p>侧边栏信息<br><img src="/img/2019/project_info_sidebar.png" alt><br>上图中info页显示当前的项目名</p>
</li>
</ol>
<p><img src="/img/2019/project_local_changes.png" alt><br>上图中history页中，Local Changes下的Local files显示当前变更的文件，点击文件名可以看到具体节点的变化内容，按+就相当于git add filename的意思；Changes to commit显示已经add还没commit的文件，按commit后会让你输入描述，确定后就是git commit -m “description”。</p>
<p><img src="/img/2019/project_commit_history.png" alt><br>上图中，Commit History可以看到提交的历史。若设置了远程仓库地址，在这里还能看到本地比远程ahead了几个commit之类的信息，也可以push或者pull操作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/22/node-red代码版本控制/" data-id="ck1us3rgi0003tc0o4a5lxlwi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-red/">node-red</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Raspbian Stretch Lite设置wifi及静态IP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/08/Raspbian Stretch Lite设置wifi及静态IP/" class="article-date">
  <time datetime="2018-12-08T04:05:36.000Z" itemprop="datePublished">2018-12-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/08/Raspbian Stretch Lite设置wifi及静态IP/">Raspbian Stretch Lite设置wifi及静态IP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>记录以备查</p>
<ol>
<li>设置要连接的wifi名称和密码</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>
<p>添加内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;wifi_name&quot;</span><br><span class="line">    psk=&quot;wifi_password&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>设置wifi连接下的静态ip</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/dhcpcd.conf</span><br></pre></td></tr></table></figure>
<p>按照上面的例子添加内容，这里假设所在网段为192.168.8.1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface wlan0</span><br><span class="line">static ip_address=192.168.8.111/24</span><br><span class="line">static routers=192.168.8.1</span><br><span class="line">static domain_name_servers=192.168.8.1 8.8.8.8</span><br></pre></td></tr></table></figure></p>
<p>如果要设置有线网的静态ip，把interface wlan0改为interface eth0即可。</p>
<ol start="3">
<li>以上前提为ssh已连接<br>在现在的版本镜像中，将image刷入microsd卡后，新建一个没有后缀的ssh文件开启功能。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch ssh</span><br></pre></td></tr></table></figure>
<p>参考</p>
<ol>
<li><a href="https://blog.csdn.net/wangteng12345678/article/details/77140773" target="_blank" rel="noopener">树莓派3B命令行配置wifi，远程桌面连接，扩展存储</a></li>
<li><a href="https://blog.csdn.net/u011973222/article/details/72843127" target="_blank" rel="noopener">Raspberry PI 3静态IP配置</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/08/Raspbian Stretch Lite设置wifi及静态IP/" data-id="ck1us3rgk0005tc0owgc70p3z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树莓派/">树莓派</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/05/Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上/" class="article-date">
  <time datetime="2018-12-05T12:39:12.000Z" itemprop="datePublished">2018-12-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/05/Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上/">Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>记录下在Raspbian Stretch Lite安装kivy的过程以备查</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol>
<li>从树莓派官网下载<a href="https://www.raspberrypi.org/downloads/raspbian/" target="_blank" rel="noopener">Raspbian Stretch Lite镜像</a></li>
<li>windows通过Win32DiskImager（macos可通过Etcher或者命令行）将.img刷入microsd卡（此处使用的是3b）。Stretch Lite的话，4g的卡即可，但现在一般不会买4g了。。。</li>
<li>在/boot/目录新建不含后缀的文件ssh，开启ssh功能</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch ssh</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>上电，ssh连接。</li>
</ol>
<h2 id="在树莓派上安装kivy"><a href="#在树莓派上安装kivy" class="headerlink" title="在树莓派上安装kivy"></a>在树莓派上安装kivy</h2><p>官方安装指南<a href="https://kivy.org/doc/stable/installation/installation-rpi.html#manual-installation-on-raspbian-jessie-stretch" target="_blank" rel="noopener">Installation on Raspberry Pi</a></p>
<p>此处想要安装的是python3版本，将官方教程的pip和python改为pip3和python3</p>
<p>1.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<p>2.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 这里如果说没有获取某些包让apt-get update或者--fix-missing那就再后面加上--fix-missing</span><br><span class="line"></span><br><span class="line">sudo apt-get install libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev \</span><br><span class="line">   pkg-config libgl1-mesa-dev libgles2-mesa-dev \</span><br><span class="line">   python3-setuptools libgstreamer1.0-dev git-core \</span><br><span class="line">   gstreamer1.0-plugins-&#123;bad,base,good,ugly&#125; \</span><br><span class="line">   gstreamer1.0-&#123;omx,alsa&#125; python3-dev libmtdev-dev \</span><br><span class="line">   xclip xsel python3-pip</span><br></pre></td></tr></table></figure></p>
<p>3.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install -U Cython==0.28.2</span><br></pre></td></tr></table></figure></p>
<p>4.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install git+https://github.com/kivy/kivy.git@master</span><br></pre></td></tr></table></figure></p>
<p>太慢了，就直接浏览器下载了<a href="https://codeload.github.com/kivy/kivy/zip/stable-1.10" target="_blank" rel="noopener">1.10.x的stable版本</a>，再通过WinSCP传到树莓派。</p>
<p>5.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd kivy-stable-1.10</span><br></pre></td></tr></table></figure></p>
<p>6.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></p>
<p>make这里会报错，后面再一起记录下</p>
<p>7.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;export PYTHONPATH=$(pwd):\$PYTHONPATH&quot; &gt;&gt; ~/.profile</span><br></pre></td></tr></table></figure></p>
<p>8.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.profile</span><br></pre></td></tr></table></figure></p>
<ol start="9">
<li>运行demo</li>
</ol>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ol>
<li>make报错Cython is missing, it’s required for compiling kivy !<br>这里通过改变Makefile的PYTHON值解决</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano Makefile</span><br></pre></td></tr></table></figure>
<p>把第一行PYTHON=python改为PYTHON=python3，因为之前依赖所安装的都是python3的，Cython也是。<br>经过很长时间的等待，编译就通过了。<br>这个时候运行demo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 kivy-stable-1.10/examples/demo/showcase/main.py</span><br></pre></td></tr></table></figure></p>
<p>会继续报错</p>
<ol start="2">
<li>运行main.py报错ImportError: No module named ‘pygments’</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install pygments</span><br></pre></td></tr></table></figure>
<p>不得不提下面这个issue里有个comment简直道出了我的心声<br><a href="https://github.com/kivy/kivy/issues/2115" target="_blank" rel="noopener">Unable to run kivy on raspberry pi with</a></p>
<blockquote>
<p>aleksandaratanasov commented on 4 May 2016<br>Shouldn’t this dependency be actually listed as such? I find it rather annoying that following the official guide on installing Kivy on the RPi you have to dig into the issues on GitHub to find a solution for this problem. After all the demos should be the ones that run without any issues WITH the things that are listed as requirements to get Kivy installed on the system. Please consider adding at least a warning if the required packages for the showcase are not met.</p>
</blockquote>
<ol start="3">
<li>这个时候运行python3 kivy-stable-1.10/examples/demo/showcase/main.py这个demo不会报错了，但是如果不连接显示屏就看不到效果。</li>
<li>树莓派连接显示屏显示no signal</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /boot/config.txt</span><br></pre></td></tr></table></figure>
<p>把<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#hdmi_force_hotplug=1</span><br></pre></td></tr></table></figure></p>
<p>的注释去掉，变为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdmi_force_hotplug=1</span><br></pre></td></tr></table></figure></p>
<p>参考<a href="https://www.raspberrypi.org/forums/viewtopic.php?t=34061" target="_blank" rel="noopener">HDMI monitors says NO SIGNAL (solved)</a></p>
<ol start="5">
<li>重启后运行demo应该有显示了，但是发现触摸好像没反应。<br>参考官方安装指南中<a href="https://kivy.org/doc/stable/installation/installation-rpi.html#using-official-rpi-touch-display" target="_blank" rel="noopener">Using Official RPi touch display</a></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano ~/.kivy/config.ini</span><br></pre></td></tr></table></figure>
<p>更改[input]模块为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mouse = mouse</span><br><span class="line">mtdev_%(name)s = probesysfs,provider=mtdev</span><br><span class="line">hid_%(name)s = probesysfs,provider=hidinput</span><br></pre></td></tr></table></figure></p>
<p>到这里就正常显示及操作了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/05/Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上/" data-id="ck1us3rgg0002tc0og2ae3avf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kivy/">Kivy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树莓派/">树莓派</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-buildozer打包kivy应用程序为安卓apk时卡在refreshing resources" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/16/buildozer打包kivy应用程序为安卓apk时卡在refreshing resources/" class="article-date">
  <time datetime="2018-10-16T12:28:13.000Z" itemprop="datePublished">2018-10-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/16/buildozer打包kivy应用程序为安卓apk时卡在refreshing resources/">buildozer打包kivy应用程序为安卓apk时卡在refreshing resources</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>按照kivy官方教程<a href="https://kivy.org/doc/stable/guide/packaging-android.html#packaging-android" target="_blank" rel="noopener">Create a package for Android</a></p>
<p>在ubuntu虚拟机下运行到以下命令时卡在Refresh Sources: Fetching <a href="https://dl-ssl.google.com/android/repository/addons_list-2.xml" target="_blank" rel="noopener">https://dl-ssl.google.com/android/repository/addons_list-2.xml</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildozer android debug deploy run</span><br></pre></td></tr></table></figure></p>
<p>按<a href="https://blog.csdn.net/u010726042/article/details/53187937" target="_blank" rel="noopener">VMWare虚拟机通过主机shadowsocks代理上网</a>开启了代理后，即使可以在浏览器访问该链接也还是无法进行下去。</p>
<p>翻了好多帖子后，在<a href="https://kivyspacegame.wordpress.com/2014/06/30/tutorial-how-to-build-python-for-android-with-ubuntu-and-buildozer/" target="_blank" rel="noopener">How to build Python for Android with Ubuntu and Buildozer</a>的回复下发现有一条写</p>
<blockquote>
<p>Moved forward by following below .cfg solution.<br><a href="http://stackoverflow.com/questions/10634202/android-sdk-manager-proxy-settings-in-linux" target="_blank" rel="noopener">http://stackoverflow.com/questions/10634202/android-sdk-manager-proxy-settings-in-linux</a></p>
</blockquote>
<p>按最高赞的回复解决。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/.android/androidtool.cfg</span><br></pre></td></tr></table></figure></p>
<p>根据个人实际情况按以下格式修改:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http.proxyPort=1080  # 宿主机上shadowsocks的代理端口</span><br><span class="line">sdkman.monitor.density=108</span><br><span class="line">http.proxyHost=192.168.2.xxx  # 宿主机的ip，这里为192.168.2.xxx</span><br><span class="line">sdkman.show.update.only=true</span><br><span class="line">sdkman.ask.adb.restart=false</span><br><span class="line">sdkman.force.http=true</span><br><span class="line">sdkman.show.updateonly=true</span><br></pre></td></tr></table></figure></p>
<p>后续又卡在了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Downloading hostpython2 from https://python.org/ftp/python/2.7.2/Python-2.7.2.tar.bz2</span><br></pre></td></tr></table></figure></p>
<p>报错为</p>
<blockquote>
<p>IOError: [Errno socket error] [SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:590)</p>
</blockquote>
<p>未能找到解决方案，转而使用kivy提供的虚拟机<a href="https://kivy.org/doc/stable/guide/packaging-android-vm.html" target="_blank" rel="noopener">The Kivy Android Virtual Machine</a>，同样进行了SDK Manager代理设置后，成功打包了apk文件，在四儿子上测试安装可运行。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/16/buildozer打包kivy应用程序为安卓apk时卡在refreshing resources/" data-id="ck1us3rgm0007tc0o3v6sl2y7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kivy/">Kivy</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-运行Node-RED官方docker后安装serial节点" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/12/运行Node-RED官方docker后安装serial节点/" class="article-date">
  <time datetime="2018-10-12T12:11:56.000Z" itemprop="datePublished">2018-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/12/运行Node-RED官方docker后安装serial节点/">运行Node-RED官方docker后安装serial节点</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="在ubuntu上安装docker"><a href="#在ubuntu上安装docker" class="headerlink" title="在ubuntu上安装docker"></a>在ubuntu上安装docker</h3><p><a href="https://yeasy.gitbooks.io/docker_practice/install/ubuntu.html" target="_blank" rel="noopener">Ubuntu 安装 Docker CE</a></p>
<h3 id="在docker下运行Node-RED"><a href="#在docker下运行Node-RED" class="headerlink" title="在docker下运行Node-RED"></a>在docker下运行Node-RED</h3><p><a href="https://nodered.org/docs/platforms/docker" target="_blank" rel="noopener">Running under Docker</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 1880:1880 --name mynodered nodered/node-red-docker</span><br></pre></td></tr></table></figure>
<p><a href="https://hub.docker.com/r/nodered/node-red-docker/" target="_blank" rel="noopener">参数解释</a></p>
<p>查看镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls</span><br></pre></td></tr></table></figure></p>
<p>查看所有容器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container ls -a</span><br></pre></td></tr></table></figure></p>
<p>访问127.0.0.1:1880后，发现没有所需的serial节点，要在容器中自行安装。</p>
<h3 id="在容器中安装serial节点"><a href="#在容器中安装serial节点" class="headerlink" title="在容器中安装serial节点"></a>在容器中安装serial节点</h3><p><a href="https://yeasy.gitbooks.io/docker_practice/image/commit.html" target="_blank" rel="noopener">利用 commit 理解镜像构成</a></p>
<p>进入该名为mynodered的容器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mynodered bash</span><br></pre></td></tr></table></figure></p>
<p>终端就会从user@ubuntu之类的变成node-red@container_id这种:<br><a href="https://flows.nodered.org/node/node-red-node-serialport" target="_blank" rel="noopener">安装serial节点</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i node-red-node-serialport</span><br><span class="line"># ... 等待安装完成</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<p>查看具体改动:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker diff mynodered</span><br></pre></td></tr></table></figure></p>
<h3 id="提交为镜像"><a href="#提交为镜像" class="headerlink" title="提交为镜像"></a>提交为镜像</h3><p>暂略</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/12/运行Node-RED官方docker后安装serial节点/" data-id="ck1us3rgu000etc0om6if3itt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-RED/">Node-RED</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/serial/">serial</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-树莓派刷LEDE(OpenWRT)后开机自启frpc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/08/树莓派刷LEDE(OpenWRT)后开机自启frpc/" class="article-date">
  <time datetime="2018-10-08T13:30:47.000Z" itemprop="datePublished">2018-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/08/树莓派刷LEDE(OpenWRT)后开机自启frpc/">树莓派刷LEDE(OpenWrt)后开机自启frpc</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>树莓派安装LEDE实现翻墙后，总想搞点事情比如远程下载之类。<br>因为租房的联通网并没有公网IP也懒得折腾，之前用过ngrok，最近无意中发现frp就用上了。<br>参考<a href="https://wiki.openwrt.org/doc/techref/initscripts" target="_blank" rel="noopener">OpenWrt Init Scripts</a>设置未果，一直苦于树莓派上的frpc服务没能开机自启，远程时就不敢瞎折腾。<br>最终参考<a href="https://blog.ferstar.org/post/deploy-frp-on-openwrt/" target="_blank" rel="noopener">deploy-frp-on-openwrt</a>得以解决，似乎是启动顺序问题，在frpc脚本运行到的时候仍有需要的服务未开启。<br>救命语句<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep 30</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/lede17.01_autostart_frpc_when_reboot.png" alt></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/08/树莓派刷LEDE(OpenWRT)后开机自启frpc/" data-id="ck1us3rgs000dtc0or36plpvr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LEDE/">LEDE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/frp/">frp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开机自启/">开机自启</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树莓派/">树莓派</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-PyQt5程序用PyInstaller打包依赖后运行报错could not find or load the Qt platform plugin windows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/27/PyQt5程序用PyInstaller打包依赖后运行报错could not find or load the Qt platform plugin windows/" class="article-date">
  <time datetime="2018-09-27T12:46:13.000Z" itemprop="datePublished">2018-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/27/PyQt5程序用PyInstaller打包依赖后运行报错could not find or load the Qt platform plugin windows/">PyQt5程序用PyInstaller打包依赖后运行报错could not find or load the Qt platform plugin windows</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用PyQt5写了个简单的程序，PyInstaller打包依赖后在两个同事电脑上运行正常，但另一同事使用后发现报错，内容为：</p>
<blockquote>
<p>This application failed to start because it could not find or load the Qt platform plugin “windows” in “”.</p>
<p>Reinstalling the application may fix this problem.</p>
</blockquote>
<p>谷歌到的相关问题很多，参考<a href="https://stackoverflow.com/questions/20495620/qt-5-1-1-application-failed-to-start-because-platform-plugin-windows-is-missi" target="_blank" rel="noopener">Qt 5.1.1: Application failed to start because platform plugin “windows” is missing</a>进行了一系列的尝试，比如：</p>
<ol>
<li>在.exe同目录下添加Qt目录下的platforms\qwindows.dll</li>
<li>在.exe通路录下添加Qt目录下的libEGL.dll</li>
<li>。。。</li>
</ol>
<p>均无果。</p>
<p><img src="/img/pyqt5_error.png" alt></p>
<p>最后无意中发现U盘直接拷贝过去的可以进行，而区别在于目录名一个为中文（❌）一个为英文（✔）。</p>
<p>对于我这种情况的解决方案：把程序放在纯英文目录下。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/27/PyQt5程序用PyInstaller打包依赖后运行报错could not find or load the Qt platform plugin windows/" data-id="ck1us3rgf0001tc0oe3wj437a" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PyInstaller/">PyInstaller</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PyQt5/">PyQt5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/打包/">打包</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-在Kivy中自定义MyCheckBox改变显示尺寸" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/05/在Kivy中自定义MyCheckBox改变显示尺寸/" class="article-date">
  <time datetime="2018-09-05T13:23:23.000Z" itemprop="datePublished">2018-09-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/05/在Kivy中自定义MyCheckBox改变显示尺寸/">在Kivy中自定义MyCheckBox改变显示尺寸</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://kivy.org/#home" target="_blank" rel="noopener">Kivy</a>是一个用于快速开发交互界面应用程序的开源python库，如多点触控应用。<br>跨平台，支持 Linux, Windows, OS X, Android, iOS, Raspberry Pi。<br>更多请移步前辈们翻译的<a href="https://github.com/Kivy-CN/Kivy-CN" target="_blank" rel="noopener">Kivy中文编程指南</a></p>
<p>工作原因，已使用Kivy4个多月，期间遇到了很多问题，大多能通过stackoverflow等平台解决，难解决的也已另辟蹊径或折衷个方法。最终还是决定记录下这些过程。</p>
<p>需求： CheckBox显示的尺寸太小，在10.1寸的显示屏上操作时需要小心翼翼，要将其尺寸改大</p>
<p>参考<a href="https://www.reddit.com/r/kivy/comments/424m2o/checkbox_size_scale/，" target="_blank" rel="noopener">https://www.reddit.com/r/kivy/comments/424m2o/checkbox_size_scale/，</a> 就知道可以通过自定义一个MyCheckBox来改变其在normal状态（inactive）和down状态（avtive）的背景图片以达到目的。</p>
<p>因Kivy源码checkbox.py中为<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckBox</span><span class="params">(ToggleButtonBehavior, Widget)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>查看文档中<a href="https://kivy.org/doc/stable/api-kivy.uix.behaviors.togglebutton.html" target="_blank" rel="noopener">ToggleButtonBehavior</a>处，Kivy已给出很直观的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.image <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> kivy.uix.behaviors <span class="keyword">import</span> ToggleButtonBehavior</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyButton</span><span class="params">(ToggleButtonBehavior, Image)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        super(MyButton, self).__init__(**kwargs)</span><br><span class="line">        self.source = <span class="string">'atlas://data/images/defaulttheme/checkbox_off'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_state</span><span class="params">(self, widget, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value == <span class="string">'down'</span>:</span><br><span class="line">            self.source = <span class="string">'atlas://data/images/defaulttheme/checkbox_on'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.source = <span class="string">'atlas://data/images/defaulttheme/checkbox_off'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleApp</span><span class="params">(App)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> MyButton()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SampleApp().run()</span><br></pre></td></tr></table></figure>
<p>对于我个人的需求，只需找两张合适大小的图片对应两个不同的状态就行（未考虑disabled状态），此处我将图片放在项目的main.py同目录下，为对比显示添加了部分代码，如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.image <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> kivy.uix.behaviors <span class="keyword">import</span> ToggleButtonBehavior</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.uix.checkbox <span class="keyword">import</span> CheckBox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyButton</span><span class="params">(ToggleButtonBehavior, Image)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        super(MyButton, self).__init__(**kwargs)</span><br><span class="line">        self.source = <span class="string">'./mycheckbox_off.png'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_state</span><span class="params">(self, widget, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value == <span class="string">'down'</span>:</span><br><span class="line">            self.source = <span class="string">'./mycheckbox_on.png'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.source = <span class="string">'./mycheckbox_off.png'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLayout</span><span class="params">(BoxLayout)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        super(MyLayout, self).__init__(**kwargs)</span><br><span class="line">        kivy_checkbox = CheckBox()</span><br><span class="line">        my_checkbox = MyButton()</span><br><span class="line">        self.add_widget(kivy_checkbox)</span><br><span class="line">        self.add_widget(my_checkbox)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleApp</span><span class="params">(App)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> MyLayout()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SampleApp().run()</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/checkbox.png" alt></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/05/在Kivy中自定义MyCheckBox改变显示尺寸/" data-id="ck1us3rgr000btc0o30u8xsyh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CheckBox/">CheckBox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kivy/">Kivy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ToggleButton/">ToggleButton</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-一次跳闸引起的ubuntu命令学习记录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/01/一次跳闸引起的ubuntu命令学习记录/" class="article-date">
  <time datetime="2017-09-01T07:41:01.000Z" itemprop="datePublished">2017-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/01/一次跳闸引起的ubuntu命令学习记录/">一次跳闸引起的ubuntu命令学习记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ubuntu命令行学习记录"><a href="#ubuntu命令行学习记录" class="headerlink" title="ubuntu命令行学习记录"></a>ubuntu命令行学习记录</h1><p>公司有个ubuntu12.04系统的samba文件服务器。一次意外跳闸后，就无法进入系统了。文件检测卡在checking battery之类，可以ctrl+alt+F1然后登陆。</p>
<p>经多次推测排查，认为是意外断电导致的文件系统丢失等问题。<br>/usr/lib/x86_64-linux-gnu/目录下的共享动态链接库等都消失了。即使dpkg -i libapt-pkg.deb后也没用。</p>
<p>定位某个库文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate libapt-pkg.so.5.0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l;  # 查看硬盘和分区情况</span><br></pre></td></tr></table></figure>
<p>Disk /dev/sda doesn’t contain a valid partition table这种提示是正常的！！如果没分区直接挂载使用当然没有分区表！！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo df -h; # 查看挂载的设备的大小</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo du -h --max-depth=1 /fileDirectory; # 查看单个目录的大小，最后一项会显示为./大小。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mount /dev/sdb /mnt;</span><br><span class="line">ls /mnt; # 为/dev/sdb/下内容</span><br><span class="line">sudo umount /mnt;</span><br><span class="line">ls /mnt; # 为空</span><br></pre></td></tr></table></figure>
<h2 id="用ultralISO制作U盘启动盘"><a href="#用ultralISO制作U盘启动盘" class="headerlink" title="用ultralISO制作U盘启动盘"></a>用ultralISO制作U盘启动盘</h2><p>用U盘启动盘try ubuntu，查看其他硬盘状态；<br>必须先取消挂载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /media/uuid/;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fsck /dev/sdb/;</span><br></pre></td></tr></table></figure>
<p>ubuntu分区问题<br>/：          4g，系统所在分区，boot可以不单独分区直接放/下<br>/home：      其他所有<br>swap区：      2G，一般按物理内存大小分配？</p>
<p>##设置静态ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/network/interfaces</span><br></pre></td></tr></table></figure>
<h2 id="关于防火墙配置"><a href="#关于防火墙配置" class="headerlink" title="关于防火墙配置"></a>关于防火墙配置</h2><p>一个相对iptables简单很多的防火墙配置工具：ufw，默认不启用。也就是说，ubuntu的端口默认都是开放的。<br>启动ufw：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default deny</span><br><span class="line">$ sudo ufw enable</span><br></pre></td></tr></table></figure>
<p>打开ssh服务的22端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow 22</span><br></pre></td></tr></table></figure>
<p>由于在/etc/services中， 22端口对应的服务名是ssh。所以下面的命令是一样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow ssh</span><br></pre></td></tr></table></figure>
<p>禁用22端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw delete allow 22</span><br></pre></td></tr></table></figure>
<p>查看防火墙状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status</span><br></pre></td></tr></table></figure>
<p>关闭防火墙：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudu ufw disable</span><br></pre></td></tr></table></figure>
<p>更多用法可以通过以下命令查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man ufw</span><br></pre></td></tr></table></figure>
<h2 id="关于开启ssh登陆"><a href="#关于开启ssh登陆" class="headerlink" title="关于开启ssh登陆"></a>关于开启ssh登陆</h2><p>新安装的ubuntu系统，默认是不支持ssh登录的。<br>SSH分客户端openssh-client和openssh-server<br>如果只是想登陆别的机器的SSH只需要安装openssh-client（ubuntu有默认安装，如果没有则sudoapt-get install openssh-client），如果要使本机开放SSH服务就需要安装openssh-server。<br>这里根据需求只安装了服务端。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>
<p>开启和停止ssh服务端：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#启动</span><br><span class="line">$ /etc/init.d/ssh start</span><br><span class="line"></span><br><span class="line">#停止</span><br><span class="line">$ /etc/init.d/ssh stop</span><br><span class="line"></span><br><span class="line">#重新启动</span><br><span class="line">$ /etc/init.d/ssh restart</span><br><span class="line"></span><br><span class="line">#利用service命令</span><br><span class="line">#启动</span><br><span class="line">$ sudo service ssh start</span><br><span class="line"></span><br><span class="line">#停止</span><br><span class="line">$ sudo service ssh stop</span><br><span class="line"></span><br><span class="line">#重新启动</span><br><span class="line">$ sudo service ssh restart</span><br></pre></td></tr></table></figure>
<p>查看ssh是否在运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#如果没有任何显示，是没有运行ssh服务的。反之，出现sshd字样，表示ssh服务已运行。</span><br><span class="line">$ sudo ps -e |grep ssh</span><br></pre></td></tr></table></figure>
<p>ssh配置文件地址：<code>/etc/ssh/sshd_config</code></p>
<p>到这里就不得不提一下安全性。。因为我有个鲨鱼的小机只用来搭$$居然也有1000+次尝试登录失败的提醒。<br>（1）改ssh的默认端口为其他如2333<br>改之前先将2333端口打开，配置文件中的port从22改为2333，然后service ssh restart重启服务，命令行指定端口号为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -p 2333 userName@ip</span><br></pre></td></tr></table></figure></p>
<p>（2）在配置里禁止root登陆，创建密钥对登陆，详见<a href="https://loricheung.github.io/2016/10/02/ssh-server-with-public-key.html" target="_blank" rel="noopener">使用密钥认证服务器</a>但是当你需在不同机器上登录时还是会有点麻烦，而且万一丢失了私钥也会比较麻烦。</p>
<h2 id="关于linux系统下的挂载"><a href="#关于linux系统下的挂载" class="headerlink" title="关于linux系统下的挂载"></a>关于linux系统下的挂载</h2><p>详见<a href="http://bruce007.blog.51cto.com/7748327/1322236" target="_blank" rel="noopener">Ubuntu - 硬盘分区、格式化、自动挂载配置</a></p>
<p>根据UUID自动挂载要修改/etc/fstab 文件，一般不重新分区UUID号不会变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo blkid # 查看设备uuid</span><br></pre></td></tr></table></figure>
<h2 id="关于samba文件服务器"><a href="#关于samba文件服务器" class="headerlink" title="关于samba文件服务器"></a>关于samba文件服务器</h2><p>Samba的配置文件为‘/etc/samba/smb.conf’。<br>开启smbd服务后有时候还是无法连接，可能是防火墙的原因，通过关闭防火墙来验证。如果是，只用文件和打印共享服务的话，开启139(TCP)端口就可以。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service smbd restart</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 测试工具。比如设置的限定用户无效。</span><br><span class="line">$ sudo testparm</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看已添加的sabd用户</span><br><span class="line">$ sudo pdbedit -L</span><br></pre></td></tr></table></figure>
<h2 id="scp跨机远程拷贝"><a href="#scp跨机远程拷贝" class="headerlink" title="scp跨机远程拷贝"></a><a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/scp.html" target="_blank" rel="noopener">scp跨机远程拷贝</a></h2><ol>
<li>从远处复制文件到本地目录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp root@10.6.159.147:/opt/soft/demo.tar /opt/soft/</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>从远处复制到本地</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp -r root@10.6.159.147:/opt/soft/test /opt/soft/</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>上传本地文件到远程机器指定目录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp /opt/soft/demo.tar root@10.6.159.147:/opt/soft/scptest</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>上传本地目录到远程机器指定目录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp -r /opt/soft/test root@10.6.159.147:/opt/soft/scptest</span><br></pre></td></tr></table></figure>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>因为服务器文件夹和文件名都为中文，ls -ll 后看到的都是？？？无法区分内容，按某宗师给的建议，ls -ll &gt; /seeFileName.txt 拷贝到U盘，在windows上查看中文名称。<br>从ubuntu的utf-8拷贝到windows机器上文件名会乱码且无法更改编码方式情况下，一种不严谨的做法：格式化一个ntfs的硬盘挂载上去，拷贝出来就不会，因为linux会自动转换ntfs能识别的格式。</p>
<p>参考文档：<br><a href="http://forum.ubuntu.org.cn/viewtopic.php?f=169&amp;t=292611" target="_blank" rel="noopener">Ubuntu的防火墙配置-ufw-iptables</a></p>
<p><a href="https://segmentfault.com/a/1190000004686476" target="_blank" rel="noopener">Ubuntu开启SSH登录</a></p>
<p><a href="http://blog.csdn.net/netwalk/article/details/12952051" target="_blank" rel="noopener">Ubuntu环境下SSH的安装及使用</a></p>
<p><a href="http://www.cnblogs.com/xd502djj/archive/2011/11/23/2260094.html" target="_blank" rel="noopener">Linux添加/删除用户和用户组</a></p>
<p><a href="http://seanxp.com/2016/samba/" target="_blank" rel="noopener">samba服务器配置</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/01/一次跳闸引起的ubuntu命令学习记录/" data-id="ck1us3rgs000ctc0osmyvdptn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/">ubuntu</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CheckBox/">CheckBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kivy/">Kivy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEDE/">LEDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-RED/">Node-RED</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyInstaller/">PyInstaller</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyQt5/">PyQt5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SyntaxError/">SyntaxError</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ToggleButton/">ToggleButton</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dietpi/">dietpi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frp/">frp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macos/">macos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-red/">node-red</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openGL/">openGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pishrink/">pishrink</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qt5/">qt5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serial/">serial</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vs/">vs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开机自启/">开机自启</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/打包/">打包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/树莓派/">树莓派</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CheckBox/" style="font-size: 10px;">CheckBox</a> <a href="/tags/Kivy/" style="font-size: 16.67px;">Kivy</a> <a href="/tags/LEDE/" style="font-size: 10px;">LEDE</a> <a href="/tags/Node-RED/" style="font-size: 10px;">Node-RED</a> <a href="/tags/PyInstaller/" style="font-size: 10px;">PyInstaller</a> <a href="/tags/PyQt5/" style="font-size: 10px;">PyQt5</a> <a href="/tags/SyntaxError/" style="font-size: 10px;">SyntaxError</a> <a href="/tags/ToggleButton/" style="font-size: 10px;">ToggleButton</a> <a href="/tags/dietpi/" style="font-size: 10px;">dietpi</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/frp/" style="font-size: 10px;">frp</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/macos/" style="font-size: 10px;">macos</a> <a href="/tags/node-red/" style="font-size: 10px;">node-red</a> <a href="/tags/openGL/" style="font-size: 10px;">openGL</a> <a href="/tags/pishrink/" style="font-size: 10px;">pishrink</a> <a href="/tags/python/" style="font-size: 13.33px;">python</a> <a href="/tags/qt5/" style="font-size: 10px;">qt5</a> <a href="/tags/serial/" style="font-size: 10px;">serial</a> <a href="/tags/ubuntu/" style="font-size: 13.33px;">ubuntu</a> <a href="/tags/vs/" style="font-size: 10px;">vs</a> <a href="/tags/开机自启/" style="font-size: 10px;">开机自启</a> <a href="/tags/打包/" style="font-size: 13.33px;">打包</a> <a href="/tags/树莓派/" style="font-size: 20px;">树莓派</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/10/17/dietpi镜像有时无法使用pishrink脚本缩小的原因/">dietpi镜像有时无法使用pishrink脚本缩小的原因</a>
          </li>
        
          <li>
            <a href="/2019/08/22/node-red代码版本控制/">node-red代码版本控制</a>
          </li>
        
          <li>
            <a href="/2018/12/08/Raspbian Stretch Lite设置wifi及静态IP/">Raspbian Stretch Lite设置wifi及静态IP</a>
          </li>
        
          <li>
            <a href="/2018/12/05/Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上/">Raspbian Stretch Lite安装kivy并运行demo显示在触摸屏上</a>
          </li>
        
          <li>
            <a href="/2018/10/16/buildozer打包kivy应用程序为安卓apk时卡在refreshing resources/">buildozer打包kivy应用程序为安卓apk时卡在refreshing resources</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 mokusolo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>